{%extends "dokter_dashboard.html"%} {%block content%}
<div class="content">
  <div class="page-inner">
    <div class="page-header">
      <h4 class="page-title">Deteksi</h4>
      <ul class="breadcrumbs">
        <li class="nav-home">
          <a href="/home">
            <i class="flaticon-home"></i>
          </a>
        </li>
        <li class="separator">
          <i class="flaticon-right-arrow"></i>
        </li>
        <li class="nav-item">
          <a href="/dokter/deteksi">Deteksi</a>
        </li>
      </ul>
    </div>
    <div class="row">
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title mb-3">Daftar Pemeriksaan Pasien</h5>
            <form id="upload-form" action="" method="POST">
              <div class="form-group p-0">
                <label for="data_pasien">Data Pasien</label>
                <select
                  class="form-control"
                  id="data_pasien"
                  name="data_pasien"
                  required
                >
                  <option value="-">Pilih Salah Satu</option>
                  {% for pemeriksaan in daftar_tunggu %}
                  <option value="{{ pemeriksaan.id }}">
                    {{ pemeriksaan.nik }} - {{ pemeriksaan.nama }}
                  </option>
                  {% endfor %}
                </select>
              </div>
              <input
                type="button"
                class="btn btn-outline-light rounded mt-3"
                value="Pilih Data"
                onclick="pilihDataPasien()"
              />
            </form>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card" id="detail-pemeriksaan">
          <div class="card-body">
            <h5 class="card-title" style="text-align: center">
              Detail Pemeriksaan Pasien
            </h5>
            <div class="row">
              <div class="col-6">
                <section class="section-dark">
                  <label for="judul">Tanggal Pemeriksaan :</label>
                  <p>{{ data_pemeriksaan.tanggal_pemeriksaan }}</p>
                  <label for="judul">Nomor Pasien :</label>
                  <p>PSNTB0{{ data_pemeriksaan.id }}</p>
                  <label for="judul">Nama Pasien :</label>
                  <p>{{ data_pemeriksaan.nama }}</p>
                  <label for="judul">RS Pemeriksaan :</label>
                  <p>{{ data_pemeriksaan.nama_rumah_sakit }}</p>
                </section>
              </div>
              <div class="col-6">
                <center>
                <p> Foto Rontgen</p>
                <img
                  src="{{ url_for('static', filename='xray/file.png') }}"
                  alt="Gambar Rontgen"
                  style="max-width: 200px"
                />
                </center>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row row-card-no-pd">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <div class="card-head-row">
              <h5 class="card-title">Riwayat Hasil Deteksi</h5>
            </div>
          </div>
          <div class="card-body">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Nomor</th>
                  <th scope="col">NIK Pasien</th>
                  <th scope="col">Tanggal Pemeriksaan</th>
                  <th scope="col" width="150px">Tenaga Medis</th>
                  <th scope="col">Status</th>
                  <th scope="col" width="100px">Gambar Rontgen</th>
                  <th scope="col">Hasil Analisa</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data riwayat skrining akan ditampilkan di sini -->
                <tr>
                  <th scope="row">1</th>
                  <td>SKR001</td>
                  <td>1234567890</td>
                  <td>2023-11-14</td>
                  <td>
                    Rumah Sakit XYZ<br />
                    Oleh Dr. John Doe
                  </td>

                  <td><button class="btn btn-danger">Positive</button></td>
                  <td>
                    <img
                      src="{{ url_for('static', filename='xray/file.png') }}"
                      alt="Gambar Rontgen"
                      style="max-width: 200px"
                    />
                    <a href="URL_GAMBAR" download>Download X-Ray</a>
                  </td>
                  <td>
                    Setelah melakukan pemeriksaan dan analisis, pasien ditemukan
                    memiliki indikasi Tuberkulosis (TBC). Beberapa temuan klinis
                    yang mendukung diagnosa ini termasuk: Gambar rontgen
                    menunjukkan adanya infiltrasi, kavitasi, atau opasitas yang
                    konsisten dengan infeksi tuberkulosis. Pasien mengalami
                    gejala seperti batuk yang berkepanjangan, berat badan
                    menurun, demam, dan kelelahan. Hasil tes laboratorium
                    menunjukkan adanya Mycobacterium tuberculosis. <br />
                    <strong>Rekomendasi:</strong>
                    Pasien direkomendasikan untuk segera memulai pengobatan
                    Tuberkulosis di bawah pengawasan dokter spesialis paru.
                    Pengobatan yang tepat dan konsisten sangat penting untuk
                    mengatasi infeksi dan mencegah penyebaran lebih lanjut. Kami
                    menyarankan agar pasien segera menjadwalkan konsultasi lebih
                    lanjut dengan dokter spesialis paru untuk perencanaan
                    pengobatan yang lebih rinci dan pemantauan kondisi kesehatan
                    secara berkala.
                  </td>
                </tr>
                <!-- Tambahkan baris ini untuk setiap data riwayat skrining yang ada -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function pilihDataPasien() {
    var selectElement = document.getElementById("data_pasien");
    var selectedId = selectElement.value;

    // Menggunakan Fetch API untuk mengirimkan permintaan asinkron
    fetch("/admin/pemeriksaan/" + selectedId)
      .then(response => response.json())
      .then(data => {
        // Memperbarui elemen detail-pemeriksaan dengan respons dari server
        var detailPemeriksaanElement = document.getElementById("detail-pemeriksaan");
        var detailPesanElement = document.getElementById("detail-pesan");
        var detailPemeriksaanInfoElement = document.getElementById("detail-pemeriksaan-info");

        if (data.error) {
          detailPemeriksaanElement.innerHTML = "";
          detailPesanElement.innerHTML = "Error: " + data.error;
          detailPemeriksaanInfoElement.style.display = "none";
        } else {
          // Menyusun HTML untuk menampilkan detail pemeriksaan
          var html = "<h6 class='p-5'>" + data.detail + "</h6>";
          detailPemeriksaanElement.innerHTML = html;
          detailPesanElement.innerHTML = "";
          
          // Menampilkan atau menyembunyikan elemen detail-pemeriksaan-info berdasarkan keadaan
          if (data.detailPemeriksaan) {
            detailPemeriksaanInfoElement.innerHTML = `
              <dt class="col-sm-3">ID</dt>
              <dd class="col-sm-9">${data.detailPemeriksaan.id}</dd>

              <dt class="col-sm-3">Tanggal Pemeriksaan</dt>
              <dd class="col-sm-9">${data.detailPemeriksaan.tanggal_pemeriksaan}</dd>

              <dt class="col-sm-3">NIK</dt>
              <dd class="col-sm-9">${data.detailPemeriksaan.nik}</dd>

              <dt class="col-sm-3">Nama</dt>
              <dd class="col-sm-9">${data.detailPemeriksaan.nama}</dd>

              <dt class="col-sm-3">Rumah Sakit</dt>
              <!-- Tambahkan bagian ini untuk menampilkan informasi rumah sakit -->
            `;
            detailPemeriksaanInfoElement.style.display = "block";
          } else {
            detailPemeriksaanInfoElement.innerHTML = "";
            detailPemeriksaanInfoElement.style.display = "none";
          }
        }
      })
      .catch(error => {
        console.error("Error:", error);
      });
  }
</script>
{%endblock%}
